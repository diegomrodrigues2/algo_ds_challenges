# 🛡️ Propriedades de Correção

## 🎯 Conceito Central

Algoritmos de exclusão mútua devem satisfazer três propriedades fundamentais: **mutual exclusion**, **deadlock-freedom** e **starvation-freedom**.

## 🎨 Diagrama de Estados das Propriedades

```mermaid
stateDiagram-v2
    direction LR
    [*] --> Tentando
    
    state "Seção Crítica" as CS
    
    Tentando --> CS : lock() bem-sucedido
    
    CS --> [*] : unlock()

    state "Bloqueada" as Blocked
    
    Tentando --> Blocked : lock() bloqueia
    Blocked --> CS : Outra thread libera o lock
    
    state "💀 Deadlock" as Dead
    Blocked --> Dead : ❌ Violação de Deadlock-Freedom
    
    state "🔥 Starvation" as Starved
    Blocked --> Starved : ❌ Violação de Starvation-Freedom
```

## 🎨 Diagrama de Deadlock (Filósofos Comilões)

```mermaid
graph TD
    subgraph "Ciclo de Espera (Deadlock)"
        ThreadA("👤 Thread A")
        ThreadB("👤 Thread B")
        Lock1("🔒 Lock 1")
        Lock2("🔒 Lock 2")

        ThreadA -- possui --> Lock1
        ThreadB -- possui --> Lock2
        
        ThreadA --"espera por"--> Lock2
        ThreadB --"espera por"--> Lock1
    end

    style Lock1 fill:#f9f,stroke:#333,stroke-width:2px
    style Lock2 fill:#f9f,stroke:#333,stroke-width:2px
    linkStyle 2,3 stroke:red,stroke-width:2px,stroke-dasharray: 5 5;
```

## 📊 Propriedades Fundamentais

### 🔒 Mutual Exclusion
**Seções críticas de threads diferentes não se sobrepõem**

```
Para threads A e B, e inteiros j e k:
CS_A^j → CS_B^k OU CS_B^k → CS_A^j
```

- ✅ **Safety property**: Garante correção dos resultados
- ❌ **Sem mutual exclusion**: Race conditions e resultados incorretos

### 🚫 Deadlock-Freedom  
**Se alguma thread tenta adquirir o lock, alguma thread consegue**

```
Se thread A chama lock() mas nunca adquire:
→ Outras threads completam infinitas seções críticas
```

- ✅ **Liveness property**: Sistema nunca "congela"
- ⚠️ **Threads individuais**: Podem ficar presas (starvation)

### ⭐ Starvation-Freedom
**Toda thread que tenta adquirir o lock eventualmente consegue**

```
Toda chamada para lock() eventualmente retorna
```

- ✅ **Liveness property**: Garante progresso para todas as threads
- 🔗 **Implica deadlock-freedom**: Starvation-freedom → Deadlock-freedom

## 🎨 Diagrama de Starvation

```mermaid
sequenceDiagram
    participant 👤 Thread A
    participant 👤 Thread B
    participant 👤 Thread C
    participant 🔒 Lock
    
    👤 Thread A->>🔒 Lock: Adquire lock
    👤 Thread A->>🔒 Lock: Libera lock
    👤 Thread B->>🔒 Lock: Adquire lock
    👤 Thread B->>🔒 Lock: Libera lock
    👤 Thread A->>🔒 Lock: Adquire lock
    👤 Thread A->>🔒 Lock: Libera lock
    Note over 👤 Thread C: 🔥 Starvation: Nunca consegue o lock
```

## 📋 Hierarquia de Propriedades

| Propriedade | Força | Garantia |
|-------------|-------|----------|
| **Mutual Exclusion** | 🔴 Essencial | Correção dos resultados |
| **Deadlock-Freedom** | 🟡 Importante | Sistema não congela |
| **Starvation-Freedom** | 🟢 Desejável | Progresso para todas |

## ⚡ Exemplo: Deadlock com Múltiplos Locks

```java
// Thread A: lock0.lock() → lock1.lock()
// Thread B: lock1.lock() → lock0.lock()

// Resultado: Deadlock mesmo com locks deadlock-free
```

## 🔧 Análise Prática

### ✅ Algoritmos Práticos
- **Starvation-free**: Garantia forte, mas overhead
- **Deadlock-free**: Compromisso entre correção e performance
- **Apenas mutual exclusion**: Rápido, mas pode causar starvation

### 📊 Trade-offs

| Aspecto | Starvation-Free | Deadlock-Free | Mutual Exclusion |
|---------|----------------|---------------|------------------|
| **Correção** | ✅ Máxima | ✅ Básica | ✅ Básica |
| **Performance** | ⏰ Overhead | 🚀 Moderado | 🚀 Rápido |
| **Fairness** | ✅ Garantida | ❌ Não garantida | ❌ Não garantida |
| **Complexidade** | 🔥 Alta | 🟡 Média | 🟢 Baixa | 