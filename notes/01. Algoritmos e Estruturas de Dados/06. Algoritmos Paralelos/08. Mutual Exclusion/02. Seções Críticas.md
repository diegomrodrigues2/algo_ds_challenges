# 🔒 Seções Críticas

## 🎯 Conceito Central

**Seção crítica**: Bloco de código que pode ser executado por apenas uma thread por vez. **Exclusão mútua** garante que seções críticas de threads diferentes não se sobreponham.

## 📊 Problema Clássico: Counter

### ❌ Implementação Incorreta
```java
public class Counter {
    private long value;
    
    public long getAndIncrement() {
        long temp = value;  // ⚠️ Danger zone
        value = temp + 1;   // ⚠️ Danger zone
        return temp;
    }
}
```

### ✅ Solução com Lock
```java
public class Counter {
    private long value;
    private Lock lock;
    
    public long getAndIncrement() {
        lock.lock();           // 🔒 Entrar seção crítica
        try {
            long temp = value; // ✅ Seguro
            value = temp + 1;  // ✅ Seguro
            return temp;
        } finally {
            lock.unlock();     // 🔓 Sair seção crítica
        }
    }
}
```

## 📋 Interface Lock

| Método | Descrição | Uso |
|--------|-----------|-----|
| **lock()** | Adquire o lock | Antes de entrar seção crítica |
| **unlock()** | Libera o lock | Antes de sair seção crítica |

## 🔧 Thread Well-Formed

Thread é **well-formed** se:
1. ✅ Cada seção crítica associada a Lock único
2. ✅ Chama `lock()` antes de entrar seção crítica  
3. ✅ Chama `unlock()` ao sair seção crítica

## ⚡ Padrão Java Recomendado

```java
mutex.lock();
try {
    // 🔒 Corpo da seção crítica
} finally {
    mutex.unlock(); // 🔓 Garante liberação mesmo com exceção
}
```

## 📊 Comparação: Com vs Sem Lock

| Aspecto | ❌ Sem Lock | ✅ Com Lock |
|---------|-------------|-------------|
| **Correção** | ❌ Race conditions | ✅ Exclusão mútua |
| **Performance** | 🚀 Rápido | ⏰ Overhead |
| **Confiabilidade** | ❌ Resultados incorretos | ✅ Resultados corretos |
| **Debugging** | 🔥 Difícil | 🛡️ Previsível | 